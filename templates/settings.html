{% extends 'layout.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h1 class="display-4 mb-4">
            <i class="fas fa-cog me-2"></i> Settings
        </h1>
        <p class="lead">Manage your inventory system settings and preferences.</p>
    </div>
</div>

<div class="row">
    <div class="col-md-3 mb-4">
        <!-- Settings Navigation -->
        <div class="list-group" id="settings-nav">
            <a href="#general-settings" class="list-group-item list-group-item-action active" 
               data-bs-toggle="list">
                <i class="fas fa-wrench me-2"></i> General Settings
            </a>
            <a href="#appearance-settings" class="list-group-item list-group-item-action" 
               data-bs-toggle="list">
                <i class="fas fa-palette me-2"></i> Appearance
            </a>
            <a href="#inventory-settings" class="list-group-item list-group-item-action" 
               data-bs-toggle="list">
                <i class="fas fa-boxes me-2"></i> Inventory Preferences
            </a>
            <a href="#notification-settings" class="list-group-item list-group-item-action" 
               data-bs-toggle="list">
                <i class="fas fa-bell me-2"></i> Notification Settings
            </a>
            <a href="#user-permissions" class="list-group-item list-group-item-action" 
               data-bs-toggle="list">
                <i class="fas fa-users me-2"></i> User Permissions
            </a>
            <a href="#advanced-settings" class="list-group-item list-group-item-action" 
               data-bs-toggle="list">
                <i class="fas fa-tools me-2"></i> Advanced
            </a>
        </div>
    </div>

    <div class="col-md-9">
        <!-- Settings Content -->
        <div class="tab-content" id="settings-content">
            <!-- General Settings Tab -->
            <div class="tab-pane fade show active" id="general-settings">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">General Settings</h5>
                    </div>
                    <div class="card-body">
                        <form id="generalSettingsForm">
                            <div class="mb-3">
                                <label for="company_name" class="form-label">Company Name</label>
                                <input type="text" class="form-control" id="company_name" name="company_name">
                                <div class="form-text">Used in reports and exports</div>
                            </div>
                            <div class="mb-3">
                                <label for="currency_code" class="form-label">Currency</label>
                                <input type="text" class="form-control" id="currency_code" name="currency_code" value="">
                                <div class="form-text">Currency used throughout the application</div>
                            </div>
                            <div class="mb-3">
                                <label for="timezone" class="form-label">Timezone</label>
                                <select class="form-select" id="timezone" name="timezone">
                                    <option value="Africa/Dar_es_Salaam">East Africa Time (EAT)</option>
                                    <option value="UTC">UTC</option>
                                    <option value="America/New_York">Eastern Time (ET)</option>
                                    <option value="Europe/London">Greenwich Mean Time (GMT)</option>
                                </select>
                                <div class="form-text">All dates and times will be displayed in this timezone</div>
                            </div>
                            <div class="mb-3">
                                <label for="default_language" class="form-label">Language</label>
                                <select class="form-select" id="default_language" name="default_language">
                                    <option value="en">English</option>
                                    <option value="sw">Swahili</option>
                                </select>
                            </div>
                            <button type="button" class="btn btn-primary" id="saveGeneralSettings">Save Changes</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Appearance Settings Tab -->
            <div class="tab-pane fade" id="appearance-settings">
                <div class="card appearance-card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-palette me-2"></i>Appearance Settings</h5>
                    </div>
                    <div class="card-body">
                        <form id="appearanceSettingsForm">
                            <div class="mb-4">
                                <label class="settings-label">Theme Selection</label>
                                <p class="settings-description">Choose a theme that suits your style and enhances readability. Click on any theme to preview it instantly.</p>

                                <div class="theme-selection-container">
                                    <div class="theme-grid">
                                        <div class="theme-card" data-theme="tanzanite" 
                                             tabindex="0" role="button" 
                                             aria-label="Select Tanzanite theme - Professional blue inspired by Tanzanian gemstone"
                                             data-description="Professional blue tones inspired by the Tanzanian gemstone. Perfect for business and professional use.">
                                            <div class="theme-preview theme-tanzanite" data-theme-value="tanzanite">
                                                <div class="preview-content">
                                                    <div class="preview-header"></div>
                                                    <div class="preview-body">
                                                        <div class="preview-line"></div>
                                                        <div class="preview-line"></div>
                                                    </div>
                                                </div>
                                                <div class="preview-label">Tanzanite</div>
                                                <div class="theme-checkmark">
                                                    <i class="fas fa-check"></i>
                                                </div>
                                            </div>
                                            <div class="theme-radio">
                                                <input type="radio" name="theme" id="theme_tanzanite" value="tanzanite" 
                                                    {% if session.get('user_theme') == 'tanzanite' or not session.get('user_theme') %}checked{% endif %}>
                                                <label for="theme_tanzanite">Tanzanite</label>
                                            </div>
                                            <div class="theme-description">
                                                <i class="fas fa-gem me-1"></i> Professional blue tones for business use
                                            </div>
                                        </div>

                                        <div class="theme-card" data-theme="forest" 
                                             tabindex="0" role="button" 
                                             aria-label="Select Forest theme - Calming green tones for long reading sessions"
                                             data-description="Calming green tones inspired by nature. Great for reducing eye strain during long work sessions.">
                                            <div class="theme-preview theme-forest" data-theme-value="forest">
                                                <div class="preview-content">
                                                    <div class="preview-header"></div>
                                                    <div class="preview-body">
                                                        <div class="preview-line"></div>
                                                        <div class="preview-line"></div>
                                                    </div>
                                                </div>
                                                <div class="preview-label">Forest</div>
                                                <div class="theme-checkmark">
                                                    <i class="fas fa-check"></i>
                                                </div>
                                            </div>
                                            <div class="theme-radio">
                                                <input type="radio" name="theme" id="theme_forest" value="forest" 
                                                    {% if session.get('user_theme') == 'forest' %}checked{% endif %}>
                                                <label for="theme_forest">Forest</label>
                                            </div>
                                            <div class="theme-description">
                                                <i class="fas fa-leaf me-1"></i> Calming green tones for long sessions
                                            </div>
                                        </div>

                                        <div class="theme-card" data-theme="ocean" 
                                             tabindex="0" role="button" 
                                             aria-label="Select Ocean theme - Cool blue tones inspired by the ocean"
                                             data-description="Cool blue tones inspired by ocean depths. Refreshing and clean appearance.">
                                            <div class="theme-preview theme-ocean" data-theme-value="ocean">
                                                <div class="preview-content">
                                                    <div class="preview-header"></div>
                                                    <div class="preview-body">
                                                        <div class="preview-line"></div>
                                                        <div class="preview-line"></div>
                                                    </div>
                                                </div>
                                                <div class="preview-label">Ocean</div>
                                                <div class="theme-checkmark">
                                                    <i class="fas fa-check"></i>
                                                </div>
                                            </div>
                                            <div class="theme-radio">
                                                <input type="radio" name="theme" id="theme_ocean" value="ocean" 
                                                    {% if session.get('user_theme') == 'ocean' %}checked{% endif %}>
                                                <label for="theme_ocean">Ocean</label>
                                            </div>
                                            <div class="theme-description">
                                                <i class="fas fa-water me-1"></i> Cool blue tones for a refreshing feel
                                            </div>
                                        </div>

                                        <div class="theme-card" data-theme="sunset" 
                                             tabindex="0" role="button" 
                                             aria-label="Select Sunset theme - Warm orange and yellow hues for a cozy experience"
                                             data-description="Warm orange and yellow hues inspired by sunset. Creates a cozy and welcoming atmosphere.">
                                            <div class="theme-preview theme-sunset" data-theme-value="sunset">
                                                <div class="preview-content">
                                                    <div class="preview-header"></div>
                                                    <div class="preview-body">
                                                        <div class="preview-line"></div>
                                                        <div class="preview-line"></div>
                                                    </div>
                                                </div>
                                                <div class="preview-label">Sunset</div>
                                                <div class="theme-checkmark">
                                                    <i class="fas fa-check"></i>
                                                </div>
                                            </div>
                                            <div class="theme-radio">
                                                <input type="radio" name="theme" id="theme_sunset" value="sunset" 
                                                    {% if session.get('user_theme') == 'sunset' %}checked{% endif %}>
                                                <label for="theme_sunset">Sunset</label>
                                            </div>
                                            <div class="theme-description">
                                                <i class="fas fa-sun me-1"></i> Warm hues for a cozy experience
                                            </div>
                                        </div>

                                        <div class="theme-card" data-theme="dark" 
                                             tabindex="0" role="button" 
                                             aria-label="Select Dark theme - Dark mode for comfortable night viewing"
                                             data-description="Dark theme optimized for low-light environments. Reduces eye strain during night work.">
                                            <div class="theme-preview theme-dark" data-theme-value="dark">
                                                <div class="preview-content">
                                                    <div class="preview-header"></div>
                                                    <div class="preview-body">
                                                        <div class="preview-line"></div>
                                                        <div class="preview-line"></div>
                                                    </div>
                                                </div>
                                                <div class="preview-label">Dark</div>
                                                <div class="theme-checkmark">
                                                    <i class="fas fa-check"></i>
                                                </div>
                                            </div>
                                            <div class="theme-radio">
                                                <input type="radio" name="theme" id="theme_dark" value="dark" 
                                                    {% if session.get('user_theme') == 'dark' %}checked{% endif %}>
                                                <label for="theme_dark">Dark</label>
                                            </div>
                                            <div class="theme-description">
                                                <i class="fas fa-moon me-1"></i> Dark mode for comfortable night viewing
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Live Preview Section -->
                                    <div class="live-preview-section">
                                        <h6 class="live-preview-title">
                                            <i class="fas fa-eye me-2"></i>Live Preview
                                        </h6>
                                        <div class="live-preview-container" id="livePreview">
                                            <div class="preview-header-section">
                                                <div class="preview-logo">
                                                    <i class="fas fa-boxes"></i>
                                                    <span>Inventory</span>
                                                </div>
                                                <div class="preview-nav">
                                                    <span class="preview-nav-item active">Dashboard</span>
                                                    <span class="preview-nav-item">Inventory</span>
                                                    <span class="preview-nav-item">Reports</span>
                                                </div>
                                            </div>
                                            <div class="preview-sidebar">
                                                <div class="preview-menu-item active">
                                                    <i class="fas fa-tachometer-alt"></i> Dashboard
                                                </div>
                                                <div class="preview-menu-item">
                                                    <i class="fas fa-box"></i> Items
                                                </div>
                                                <div class="preview-menu-item">
                                                    <i class="fas fa-chart-bar"></i> Reports
                                                </div>
                                            </div>
                                            <div class="preview-content-area">
                                                <div class="preview-card">
                                                    <div class="preview-card-header">Total Items</div>
                                                    <div class="preview-card-value">1,234</div>
                                                </div>
                                                <div class="preview-card">
                                                    <div class="preview-card-header">Low Stock</div>
                                                    <div class="preview-card-value warning">23</div>
                                                </div>
                                                <div class="preview-button-group">
                                                    <button class="preview-btn primary">Add Item</button>
                                                    <button class="preview-btn secondary">Export</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="items_per_page" class="form-label">Items Per Page</label>
                                <select class="form-select" id="items_per_page" name="items_per_page">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <div class="form-text">Default number of items to display in tables</div>
                            </div>
                            <div class="mb-3">
                                <label for="date_format" class="form-label">Date Format</label>
                                <select class="form-select" id="date_format" name="date_format">
                                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                </select>
                            </div>
                            <button type="button" class="btn btn-primary" id="saveAppearanceSettings">Save Changes</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Inventory Settings Tab -->
            <div class="tab-pane fade" id="inventory-settings">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Inventory Preferences</h5>
                    </div>
                    <div class="card-body">
                        <form id="inventorySettingsForm">
                            <div class="mb-3">
                                <label for="low_stock_threshold" class="form-label">Low Stock Threshold</label>
                                <input type="number" class="form-control" id="low_stock_threshold" name="low_stock_threshold" value="10" min="1">
                                <div class="form-text">Items with stock below this value will be highlighted</div>
                            </div>
                            <div class="mb-3">
                                <label for="default_category" class="form-label">Default Category</label>
                                <input type="text" class="form-control" id="default_category" name="default_category" value="Uncategorized">
                                <div class="form-text">Default category for new items</div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enable_sku_generation" name="enable_sku_generation" checked>
                                    <label class="form-check-label" for="enable_sku_generation">
                                        Auto-generate SKUs for new items
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="track_inventory_history" name="track_inventory_history" checked>
                                    <label class="form-check-label" for="track_inventory_history">
                                        Track inventory history
                                    </label>
                                </div>
                                <div class="form-text">Keep history of all inventory changes</div>
                            </div>
                            <button type="button" class="btn btn-primary" id="saveInventorySettings">Save Changes</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Notification Settings Tab -->
            <div class="tab-pane fade" id="notification-settings">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Notification Settings</h5>
                    </div>
                    <div class="card-body">
                        <form id="notificationSettingsForm">
                            <h6 class="mb-3">Low Stock Notifications</h6>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="email_notifications_enabled" name="email_notifications_enabled" checked>
                                    <label class="form-check-label" for="email_notifications_enabled">
                                        Enable Email Notifications
                                    </label>
                                </div>
                                <div class="form-text">Send email alerts when items fall below the low stock threshold</div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="sms_notifications_enabled" name="sms_notifications_enabled">
                                    <label class="form-check-label" for="sms_notifications_enabled">
                                        Enable SMS Notifications
                                    </label>
                                </div>
                                <div class="form-text">Send SMS alerts when items fall below the low stock threshold</div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enable_price_change_alerts" name="enable_price_change_alerts">
                                    <label class="form-check-label" for="enable_price_change_alerts">
                                        Enable price change alerts
                                    </label>
                                </div>
                            </div>

                            <hr class="my-4">
                            <h6 class="mb-3">Notification Recipients</h6>

                            <div class="mb-3">
                                <label for="notification_email" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="notification_email" name="notification_email">
                                <div class="form-text">Email address to receive notifications</div>
                            </div>

                            <div class="mb-3">
                                <label for="sender_email" class="form-label">Sender Email</label>
                                <input type="email" class="form-control" id="sender_email" name="sender_email" value="inventory@yourbusiness.com">
                                <div class="form-text">The email address that will appear as the sender</div>
                            </div>

                            <div class="mb-3">
                                <label for="notification_phone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="notification_phone" name="notification_phone" placeholder="+255XXXXXXXXX">
                                <div class="form-text">Phone number to receive SMS notifications (include country code, e.g., +255)</div>
                            </div>

                            <hr class="my-4">
                            <h6 class="mb-3">Threshold Settings</h6>

                            <div class="mb-3">
                                <label for="notification_low_stock_threshold" class="form-label">Low Stock Threshold</label>
                                <input type="number" class="form-control" id="notification_low_stock_threshold" name="notification_low_stock_threshold" value="10" min="1">
                                <div class="form-text">Send notifications when item quantity falls below this value</div>
                            </div>

                            <div class="mb-3">
                                <label for="notification_frequency" class="form-label">Notification Frequency</label>
                                <select class="form-select" id="notification_frequency" name="notification_frequency">
                                    <option value="immediately">Immediately</option>
                                    <option value="daily" selected>Daily Summary</option>
                                    <option value="weekly">Weekly Summary</option>
                                </select>
                                <div class="form-text">How often to send low stock notifications</div>
                            </div>

                            <button type="button" class="btn btn-primary" id="saveNotificationSettings">Save Changes</button>
                            <button type="button" class="btn btn-outline-secondary ms-2" id="testNotifications">Test Notifications</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- User Permissions Tab -->
            <div class="tab-pane fade" id="user-permissions">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-users me-2"></i>User Permissions</h5>
                        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addSubuserModal">
                            <i class="fas fa-plus me-1"></i> Add User
                        </button>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-4">Manage team members and their access permissions to different parts of your inventory system.</p>
                        
                        <!-- Subusers List -->
                        <div id="subusers-list">
                            <div class="text-center py-4" id="loading-subusers">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2 text-muted">Loading users...</p>
                            </div>
                            <div class="d-none" id="no-subusers">
                                <div class="text-center py-4">
                                    <i class="fas fa-users fa-3x text-muted mb-3"></i>
                                    <h6 class="text-muted">No team members yet</h6>
                                    <p class="text-muted">Add team members to collaborate on your inventory management.</p>
                                </div>
                            </div>
                            <div id="subusers-container"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Settings Tab -->
            <div class="tab-pane fade" id="advanced-settings">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Advanced Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i> Changing these settings may affect system behavior.
                        </div>
                        <form id="advancedSettingsForm">
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enable_debug_mode" name="enable_debug_mode">
                                    <label class="form-check-label" for="enable_debug_mode">
                                        Enable debug mode
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="data_backup_schedule" class="form-label">Data Backup Schedule</label>
                                <select class="form-select" id="data_backup_schedule" name="data_backup_schedule">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="never">Never</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enable_api_access" name="enable_api_access">
                                    <label class="form-check-label" for="enable_api_access">
                                        Enable API access
                                    </label>
                                </div>
                                <div class="form-text">Allow external applications to access your inventory data</div>
                            </div>
                            <button type="button" class="btn btn-primary" id="saveAdvancedSettings">Save Changes</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<!-- Add Subuser Modal -->
<div class="modal fade" id="addSubuserModal" tabindex="-1" aria-labelledby="addSubuserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addSubuserModalLabel">Add Team Member</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="subuserForm">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="subuserName" class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="subuserName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="subuserEmail" class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="subuserEmail" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="subuserPassword" class="form-label">Password *</label>
                                <input type="password" class="form-control" id="subuserPassword" required>
                                <div class="form-text">Minimum 6 characters</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="subuserStatus" class="form-label">Status</label>
                                <select class="form-select" id="subuserStatus">
                                    <option value="true">Active</option>
                                    <option value="false">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Permissions</label>
                        <div class="row" id="permissions-container">
                            <!-- Permissions will be loaded here -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span id="submit-btn-text">Add User</span>
                        <span class="spinner-border spinner-border-sm d-none" id="submit-spinner" role="status"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteSubuserModal" tabindex="-1" aria-labelledby="deleteSubuserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteSubuserModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong id="delete-user-name"></strong>?</p>
                <p class="text-muted small">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteSubuser">Delete User</button>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}